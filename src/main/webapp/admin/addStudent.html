<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart School System - Add Student</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/studentList.css">
    <style>
        /* Keeping your existing specific styles [cite: 81-92] */
        .form-container { width: 60%; margin: 0 auto; padding: 40px; background: #fff; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); border-radius: 15px; border: 1px solid #e5e7eb; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #5a4a42; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #d4c4b7; border-radius: 8px; font-size: 14px; }
        .form-actions { margin-top: 30px; display: flex; gap: 15px; justify-content: flex-end; }
        .btn-submit { background-color: #5a4a42; color: white; border: none; padding: 12px 30px; cursor: pointer; border-radius: 50px; font-weight: bold; transition: 0.3s; }
        .btn-cancel { background-color: #ccc; color: #333; text-decoration: none; padding: 12px 30px; border-radius: 50px; font-weight: bold; display: inline-block; transition: 0.3s; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <i class="fas fa-bars menu-toggle-icon" id="menu-toggle"></i> <span>Smart School System</span>
        </div>
        <div class="header-right">
            <div class="profile-area" id="profileBtn">
                <span class="user-name">Admin</span> 
                <img src="/assets/image/adminICON.png" alt="Admin Profile" class="profile-image">
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="adminHomepage.html" class="menu-item active"><i class="fas fa-home icon"></i> <span class="link-text">Home</span></a></li>
                <li><a href="class.html" class="menu-item"><i class="fas fa-chalkboard icon"></i> <span class="link-text">Class</span></a></li>
                <li><a href="student.html" class="menu-item"><i class="fas fa-user-graduate icon"></i> <span class="link-text">Student</span></a></li>
                <li><a href="validateTeacher.html" class="menu-item"><i class="fas fa-user-check icon"></i> <span class="link-text">Validate</span></a></li>
                <li><a href="teacherList.html" class="menu-item"><i class="fas fa-users-rectangle icon"></i> <span class="link-text">Teacher List</span></a></li>
                <li><a href="assignment.html" class="menu-item"><i class="fas fa-tasks icon"></i> <span class="link-text">Assignment</span></a></li>
                <li><a href="adminSettings.html" class="menu-item"><i class="fas fa-cog icon"></i> <span class="link-text">Settings</span></a></li>
                </ul>
        </aside>

        <main class="content">
            <div class="breadcrumb">
                <a href="student.html" style="text-decoration: none; color: inherit;">Student List</a> 
                <span class="breadcrumb-separator">&gt;</span> <span class="current-page">Add New Student</span>
            </div>

            <div class="form-container">
                <h2 style="margin-bottom: 25px; color: #5a4a42; border-bottom: 2px solid #f2e6d9; padding-bottom: 10px;">Register New Student</h2>
                <form id="addStudentForm" action="/admin/StudentListServlet" method="post" onsubmit="return validateForm()">
                    <input type="hidden" name="action" value="add">
                    <div class="form-group"><label>Full Name</label><input type="text" name="studName" required class="form-control"></div>
                    <div class="form-group"><label>IC Number</label><input type="text" name="studIC" id="studIC" placeholder="e.g. 123456011234" required onkeyup="extractDateFromIC()" maxlength="12" oninput="this.value = this.value.replace(/[^0-9]/g, '')" class="form-control"></div>
                    <div class="form-group"><label>Gender</label><select name="gender" class="form-control"><option value="Male">Male</option><option value="Female">Female</option></select></div>
                    <div class="form-group"><label>Date of Birth</label><input type="date" name="dob" id="dob" required class="form-control"></div>
                    <div class="form-group"><label>Address</label><input type="text" name="address" required class="form-control"></div>
                    <div class="form-group"><label>Guardian IC</label><input type="text" name="guardianIC" id="guardianIC" required maxlength="12" class="form-control"></div>
                    <div class="form-group">
                        <label>Year</label>
                        <select name="studYear" id="yearSelect" onchange="filterClassDropdown()" required class="form-control">
                            <option value="">-- Select Level --</option>
                            <option value="1">Year 1</option><option value="2">Year 2</option><option value="3">Year 3</option><option value="4">Year 4</option><option value="5">Year 5</option><option value="6">Year 6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Class</label>
                        <select name="classId" id="classSelect" required class="form-control">
                            <option value="">-- Select Class --</option>
                            </select>
                    </div>
                    <div class="form-actions"><a href="student.html" class="btn-cancel">Back</a><button type="submit" class="btn-submit">Add Student</button></div>
                </form>
            </div>
        </main>
    </div>

    <div id="confirmAddModal" class="modal-overlay">
        <div class="modal-box">
            <h3>Confirm Registration</h3>
            <p>Are you sure you want to register this new student?</p>
            <div class="modal-buttons" style="margin-top: 25px;">
                <button type="button" class="btn-cancel" onclick="closeConfirmAddModal()">Cancel</button>
                <button type="button" id="finalSubmitBtn" class="btn-submit">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // 1. DATA LOADER: Fetches classrooms from server
        window.onload = function() {
		    fetch('/admin/StudentListServlet?action=showAddForm')
		        .then(res => res.json())
		        .then(data => {
		            const select = document.getElementById('classSelect');
		            // Important: Use capital 'C' to match your JSON data
		            data.forEach(c => {
		                let opt = document.createElement('option');
		                opt.value = c.ClassID;      // Changed from classID to ClassID
		                opt.textContent = c.ClassName; // Changed from className to ClassName
		                opt.setAttribute('data-level', c.ClassYear); // Changed to ClassYear
		                select.appendChild(opt);
		            });
		        })
		        .catch(err => console.error("Error loading classes:", err));
		};

        // 2. Original Logic: Sidebar, IC Extraction, and Validation [cite: 103-125]
        function extractDateFromIC() {
            var val = document.getElementById("studIC").value.replace(/[^0-9]/g, '');
            if (cleanIC.length >= 6) {
                var yy = cleanIC.substring(0, 2), mm = cleanIC.substring(2, 4), dd = cleanIC.substring(4, 6);
                var fullYear = (parseInt(yy) > 30 ? "19" : "20") + yy;
                document.getElementById("dob").value = fullYear + "-" + mm + "-" + dd;
            }
        }

        function filterClassDropdown() {
            var level = document.getElementById("yearSelect").value;
            var options = document.getElementById("classSelect").options;
            for (var i = 1; i < options.length; i++) {
                var classLevel = options[i].getAttribute("data-level");
                options[i].style.display = (level === "" || classLevel === level) ? "block" : "none";
                options[i].disabled = (level !== "" && classLevel !== level);
            }
        }

        // 3. Modal Controls [cite: 126-129]
        function validateForm() {
            document.getElementById('confirmAddModal').style.display = 'flex';
            return false; 
        }
        function closeConfirmAddModal() { document.getElementById('confirmAddModal').style.display = 'none'; }
        document.getElementById('finalSubmitBtn').addEventListener('click', () => {
            document.getElementById('addStudentForm').submit();
        });
    </script>
</body>
</html>